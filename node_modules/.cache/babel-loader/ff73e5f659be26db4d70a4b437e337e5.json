{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\manpe\\\\Documents\\\\year 2\\\\sem 1\\\\react projects\\\\multiplayer-tic-tac-toe\\\\src\\\\client\\\\components\\\\Game.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport io from \"socket.io-client\";\nimport Board from \"../components/Board\";\nimport \"./Game.css\";\nlet socket = io(\"http://localhost:8000\", {\n  withCredentials: true\n}); //const socket = io.connect('http://localhost:3000');\n\nconst Game = ({\n  location\n}) => {\n  _s();\n\n  const [yourTurn, setYourTurn] = useState(queryString.parse(location.search).turn === '1' ? true : false);\n  const [squares, setSquares] = useState(Array(9).fill(null));\n  const [stepNumber, setStepNumber] = useState(0);\n  const [xPlayer, setXPlayer] = useState('');\n  const [oPlayer, setOPlayer] = useState('');\n  const [status, setStatus] = useState('');\n  const [name, setName] = useState(queryString.parse(location.search).name);\n  const [room, setRoom] = useState(queryString.parse(location.search).room);\n  const [users, setUsers] = useState(''); //const users = useRef();\n\n  const [flag, setFlag] = useState(0);\n  const [moves, setMoves] = useState(undefined);\n  const ENDPOINT = \"http://localhost:8000\"; //const users2 = users.slice();\n\n  const [count, setCount] = useState(9);\n  const [socketId, setSocketId] = useState('');\n  const [executeTimeout, setExecuteTimeout] = useState(true);\n  useEffect(() => {\n    //const { name, room } = queryString.parse(location.search);\n    socket = io.connect(ENDPOINT); //setName(queryString.parse(location.search).name);\n\n    console.log(yourTurn);\n    socket.emit(\"join\", {\n      name: queryString.parse(location.search).name,\n      room: queryString.parse(location.search).room\n    }, error => {\n      if (error) {\n        setFlag(1);\n        alert(error);\n      }\n    });\n    /*socket.on(\"move\", (data) => {\r\n      console.log(data.move);\r\n    });*/\n    //setRoom(room);\n\n    setCount(count - 1);\n    console.log(count);\n  }, [ENDPOINT, location.search]);\n  useEffect(() => {\n    const square = squares.slice();\n    socket.on('move', ({\n      move,\n      location,\n      stepNumber\n    }) => {\n      square[location] = move;\n      setSquares(move); //setStepNumber(stepNumber + 1);\n\n      console.log(tie(move));\n\n      if (tie(move) === true) {\n        setStatus('Tie');\n      } //stepNumber === 8 && setStatus(\"Tie\");\n\n      /*for(let m = 0; m<9; m++) {\r\n        move[m] !== null && setStatus('Tie');\r\n      }*/\n\n\n      console.log(squares);\n      console.log(move); //console.log(turn);\n\n      console.log(name);\n      console.log(users);\n      console.log(socketId); //console.log(stepNumber);\n    });\n    socket.on('turn', turn => {\n      setYourTurn(true);\n      setStatus('It is your turn');\n      console.log(yourTurn);\n    });\n    socket.on('roomData', ({\n      pp\n    }) => {\n      const userList = pp.slice(0, 2);\n      setUsers('');\n      setUsers(userList); //console.log(userList);\n\n      setStatus(`It is ${userList[0].name}'s turn`);\n      setXPlayer(userList[0].name);\n      setOPlayer(userList[1].name); //console.log(pp[1].name);\n      //console.log(pp[0].name);\n      //console.log(socket.id);\n\n      if (name === xPlayer) {\n        setSocketId(users[0].id);\n      } else if (name === oPlayer) {\n        setSocketId(users[1].id);\n      }\n    });\n    socket.on('warning', () => {\n      setStatus('Click play again within 10s to play again');\n      setTimeout(() => {\n        if (executeTimeout) {\n          return /*#__PURE__*/_jsxDEV(Redirect, {\n            to: '/'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 18\n          }, this);\n        }\n      }, 10000);\n    });\n  }, []);\n\n  const handleClick = i => {\n    const square = squares.slice();\n    const win = winner(square);\n\n    if (win || squares[i]) {\n      return;\n    }\n\n    if (yourTurn && squares[i] === null) {\n      square[i] = queryString.parse(location.search).turn === '1' ? 'X' : 'O';\n      setSquares(square); //setStepNumber(stepNumber + 1);\n\n      setYourTurn(false); //!playerXTurn ? setStatus(\"It is X's turn\") : setStatus(\"It is O's turn\");\n    } //squares[i] === null ? (squares[i] = this.state.playerXTurn ? 'X' : 'O';) : this.setState({status: 'Please select another tile'});\n    //squares[i] === 'X' ? this.setState({playerXTurn: !playerXTurn}) : this.setState({playerXTurn: })\n\n\n    if (win) {\n      setStatus(\"\");\n    }\n\n    socket.emit(\"move\", {\n      room: queryString.parse(location.search).room,\n      move: square,\n      location: i\n    });\n    socket.emit('turn', {\n      room: room\n    }); //set status after sending move to be other player's name\n\n    if (name === users[0].name) {\n      setStatus(`It is ${users[1].name}'s turn`);\n    } else if (name === users[1].name) {\n      setStatus(`It is ${users[0].name}'s turn`);\n    }\n  };\n\n  const handleReset = () => {\n    socket.emit('playAgain', {\n      room: room,\n      name: name,\n      id: socketId\n    });\n    setExecuteTimeout(false);\n  };\n\n  const handleExit = () => {\n    socket.emit('exit', {\n      id: socketId,\n      room: room\n    });\n  };\n\n  const winner = squares => {\n    const win = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];\n\n    for (let i = 0; i < win.length; i++) {\n      const [a, b, c] = win[i];\n\n      if (squares[a] && squares[a] === squares[b] && squares[b] === squares[c]) {\n        return squares[a];\n      }\n    }\n\n    return null;\n  };\n\n  const tie = squares => {\n    for (let m = 0; m < 9; m++) {\n      if (squares[m] === null) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  let victory;\n  const win = winner(squares);\n  const pp = tie(squares);\n\n  if (win) {\n    victory = win === 'X' ? `The winner is ${xPlayer}` : `The winner is ${oPlayer}`;\n  } //console.log(queryString.parse(location.search).room);\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"body\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"game\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Board, {\n          onClick: i => handleClick(i),\n          squares: squares\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this), win ? /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"feedback\",\n          className: \"status\",\n          children: victory\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"status\",\n          children: status\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"win\",\n          children: [(win || pp === true) && /*#__PURE__*/_jsxDEV(Link, {\n            onClick: () => handleReset(),\n            to: `/waitingRoom/${room}?name=${name}&room=${room}`,\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleReset(),\n              className: 'button mt-20',\n              children: \"Play Again?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this), (win || count === 0) && /*#__PURE__*/_jsxDEV(Link, {\n            onClick: () => handleExit(),\n            to: \"/\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleExit(),\n              className: \"button2\",\n              children: \"Exit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 228,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Game, \"pL5OZKF3CwkKgEMr4FdZgUAFSGo=\");\n\n_c = Game;\nexport default Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"sources":["C:/Users/manpe/Documents/year 2/sem 1/react projects/multiplayer-tic-tac-toe/src/client/components/Game.js"],"names":["React","useState","useEffect","useRef","Link","Redirect","queryString","io","Board","socket","withCredentials","Game","location","yourTurn","setYourTurn","parse","search","turn","squares","setSquares","Array","fill","stepNumber","setStepNumber","xPlayer","setXPlayer","oPlayer","setOPlayer","status","setStatus","name","setName","room","setRoom","users","setUsers","flag","setFlag","moves","setMoves","undefined","ENDPOINT","count","setCount","socketId","setSocketId","executeTimeout","setExecuteTimeout","connect","console","log","emit","error","alert","square","slice","on","move","tie","pp","userList","id","setTimeout","handleClick","i","win","winner","handleReset","handleExit","length","a","b","c","m","victory"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport { Link, Redirect } from \"react-router-dom\";\r\nimport queryString from \"query-string\";\r\nimport io from \"socket.io-client\";\r\n\r\nimport Board from \"../components/Board\";\r\nimport \"./Game.css\";\r\n\r\nlet socket = io(\"http://localhost:8000\", {\r\n  withCredentials: true,\r\n});\r\n//const socket = io.connect('http://localhost:3000');\r\n\r\nconst Game = ({ location }) => {\r\n  const [yourTurn, setYourTurn] = useState((queryString.parse(location.search).turn === '1' ? true : false));\r\n  const [squares, setSquares] = useState(Array(9).fill(null));\r\n  const [stepNumber, setStepNumber] = useState(0);\r\n  const [xPlayer, setXPlayer] = useState('');\r\n  const [oPlayer, setOPlayer] = useState('');\r\n  const [status, setStatus] = useState('');\r\n  const [name, setName] = useState(queryString.parse(location.search).name);\r\n  const [room, setRoom] = useState(queryString.parse(location.search).room);\r\n  const [users, setUsers] = useState('');\r\n  //const users = useRef();\r\n  const [flag, setFlag] = useState(0);\r\n  const [moves, setMoves] = useState(undefined);\r\n  const ENDPOINT = \"http://localhost:8000\";\r\n  //const users2 = users.slice();\r\n  const [count, setCount] = useState(9);\r\n  const [socketId, setSocketId] = useState('');\r\n  const [executeTimeout, setExecuteTimeout] = useState(true);\r\n\r\n  useEffect(() => {\r\n    //const { name, room } = queryString.parse(location.search);\r\n\r\n    socket = io.connect(ENDPOINT);\r\n    \r\n    \r\n    //setName(queryString.parse(location.search).name);\r\n    \r\n    console.log(yourTurn);\r\n\r\n    socket.emit(\r\n      \"join\",\r\n      {\r\n        name: queryString.parse(location.search).name,\r\n        room: queryString.parse(location.search).room,\r\n      },\r\n      (error) => {\r\n        if (error) {\r\n          setFlag(1);\r\n          alert(error);\r\n        }\r\n      }\r\n    );\r\n    /*socket.on(\"move\", (data) => {\r\n      console.log(data.move);\r\n    });*/\r\n    //setRoom(room);\r\n\r\n    \r\n    setCount(count-1);\r\n    console.log(count);\r\n\r\n  }, [ENDPOINT, location.search]);\r\n\r\n    useEffect(() => {\r\n      const square = squares.slice();\r\n\r\n      socket.on('move', ({ move, location, stepNumber }) => {\r\n        square[location] = move;\r\n        setSquares(move);\r\n        //setStepNumber(stepNumber + 1);\r\n        console.log(tie(move));\r\n        if(tie(move) === true) {setStatus('Tie')}\r\n          \r\n        //stepNumber === 8 && setStatus(\"Tie\");\r\n        /*for(let m = 0; m<9; m++) {\r\n          move[m] !== null && setStatus('Tie');\r\n        }*/\r\n        console.log(squares);\r\n        console.log(move);\r\n        //console.log(turn);\r\n        console.log(name);\r\n        console.log(users);\r\n        console.log(socketId);\r\n        //console.log(stepNumber);\r\n      });\r\n\r\n      socket.on('turn', (turn) => {\r\n        setYourTurn(true); \r\n        setStatus('It is your turn');\r\n        console.log(yourTurn);\r\n      });\r\n      \r\n\r\n      socket.on('roomData', ({ pp }) => {\r\n        const userList = pp.slice(0,2);\r\n        setUsers('');\r\n        setUsers(userList);\r\n        //console.log(userList);\r\n        setStatus(`It is ${userList[0].name}'s turn`)\r\n        setXPlayer(userList[0].name);\r\n        setOPlayer(userList[1].name);\r\n        //console.log(pp[1].name);\r\n        //console.log(pp[0].name);\r\n        //console.log(socket.id);\r\n        if(name === xPlayer) {\r\n          setSocketId(users[0].id)\r\n        }\r\n        else if(name === oPlayer) {\r\n          setSocketId(users[1].id)\r\n        }\r\n      });\r\n      socket.on('warning', () => {\r\n        setStatus('Click play again within 10s to play again')\r\n        setTimeout(() =>{\r\n          if(executeTimeout){\r\n          return(<Redirect to={'/'}></Redirect>)\r\n          }\r\n        }, 10000)\r\n      });\r\n\r\n    }, []);\r\n\r\n  const handleClick = (i) => {\r\n    const square = squares.slice();\r\n    const win = winner(square);\r\n    \r\n\r\n    if (win || squares[i]) {\r\n      return;\r\n    }\r\n\r\n    if (yourTurn && (squares[i] === null)) {\r\n      square[i] = (queryString.parse(location.search).turn === '1') ? 'X' : 'O'\r\n      setSquares(square);\r\n      //setStepNumber(stepNumber + 1);\r\n      setYourTurn(false);\r\n      //!playerXTurn ? setStatus(\"It is X's turn\") : setStatus(\"It is O's turn\");\r\n    }\r\n    //squares[i] === null ? (squares[i] = this.state.playerXTurn ? 'X' : 'O';) : this.setState({status: 'Please select another tile'});\r\n    //squares[i] === 'X' ? this.setState({playerXTurn: !playerXTurn}) : this.setState({playerXTurn: })\r\n\r\n    if (win) {\r\n      setStatus(\"\");\r\n    }\r\n\r\n    socket.emit(\"move\",  {\r\n      room: queryString.parse(location.search).room,\r\n      move: square,\r\n      location: i,\r\n    });\r\n\r\n    socket.emit('turn', {\r\n      room: room,\r\n    });\r\n    \r\n    //set status after sending move to be other player's name\r\n    if(name === users[0].name){\r\n      setStatus(`It is ${users[1].name}'s turn`)\r\n    }\r\n    else if(name === users[1].name) {\r\n      setStatus(`It is ${users[0].name}'s turn`)\r\n    }\r\n  };\r\n\r\n  const handleReset = () => {\r\n    socket.emit('playAgain', {\r\n      room: room,\r\n      name: name,\r\n      id: socketId\r\n    })\r\n    setExecuteTimeout(false);\r\n  };\r\n\r\n  const handleExit = () => {\r\n    socket.emit('exit', {\r\n      id: socketId,\r\n      room: room\r\n    });\r\n  };\r\n\r\n  const winner = (squares) => {\r\n    const win = [\r\n      [0, 1, 2],\r\n      [3, 4, 5],\r\n      [6, 7, 8],\r\n      [0, 3, 6],\r\n      [1, 4, 7],\r\n      [2, 5, 8],\r\n      [0, 4, 8],\r\n      [2, 4, 6],\r\n    ];\r\n\r\n    for (let i = 0; i < win.length; i++) {\r\n      const [a, b, c] = win[i];\r\n      if (\r\n        squares[a] &&\r\n        squares[a] === squares[b] &&\r\n        squares[b] === squares[c]\r\n      ) {\r\n        return squares[a];\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const tie = (squares) => {\r\n    for(let m = 0; m<9 ; m++) {\r\n      if(squares[m] === null ) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  let victory;\r\n  const win = winner(squares);\r\n  const pp = tie(squares);\r\n  if (win) {\r\n    victory = (win === 'X') ? `The winner is ${xPlayer}` : `The winner is ${oPlayer}`\r\n  }\r\n\r\n  //console.log(queryString.parse(location.search).room);\r\n\r\n  return (\r\n    <div className='body'>\r\n      <div className='game'>\r\n        <div>\r\n          <Board onClick={(i) => handleClick(i)} squares={squares} />\r\n          <br />\r\n          {win ? (\r\n            <div id='feedback' className='status'>\r\n              {victory}\r\n            </div>\r\n          ) : (\r\n            <div className='status'>{status}</div>\r\n          )}\r\n          <br />\r\n\r\n          <div className='win'>\r\n            {(win || pp === true) && (\r\n              <Link onClick={() => handleReset()} to={`/waitingRoom/${room}?name=${name}&room=${room}`} >\r\n                    <button onClick={() => handleReset()} className ={'button mt-20'}>Play Again?</button>\r\n              </Link>\r\n            )}\r\n            <br></br>\r\n            <br></br>\r\n            {(win || count === 0) && (\r\n              <Link onClick={() => handleExit()} to={\"/\"}>\r\n                <button onClick={() => handleExit()}className='button2'>Exit</button>\r\n              </Link>\r\n            )}\r\n          </div>\r\n          <br></br>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Game;"]},"metadata":{},"sourceType":"module"}